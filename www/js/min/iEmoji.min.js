var router=function(){"use strict";function n(n,a){r.push({parts:n.split("/"),handler:a})}function a(n){window.location.hash=n}function t(){for(var n=window.location.hash.substr(1),a=0;a<r.length;a++)for(var t=r[a],s=0;s<t.parts.length;s++)if(t.parts[s]&&(n||(n=t.parts[s]="index"),-1===n.indexOf("/")&&n===t.parts[s]&&t.handler.apply(null),n.indexOf("/")>-1&&n.split("/")[0]===t.parts[s])){var i=[];i.push(n.split("/")[1]),t.handler.apply(null,i)}}var r=[];return $(window).on("hashchange",t),{addRoute:n,load:a,start:t}}();
function generateData(){for(var e=["blink","chill","chuckle","confused","cry","drooling","drowsy","embarrassed","flushed","grimace","grin","hellooo","hotkiss","hypnotized","inthedark","laugh","like","onfire","panic","pig","pleased","pucker","puke","scold","scowl","scream","sick","silence","skull","sleep","smile","smug","sneer","sniffle","sob","sobeye","strive","surprised","sweating","wink"],o=["大多数人想要改造这个世界，但却罕有人想改造自己","土是用来挖的，坑是用来埋你的","人生苦短，必须性感","青山依旧在，只是有点红","人生的悲哀就在于，当你想两肋插刀的时候，却只有一把刀","祝愿天下有情人都是失散多年的兄妹。","明月几时有，去问易中天","熬夜，是因为没有勇气结束这一天","赖床，是因为没有勇气开始这一天","女追男，隔层纱；男追女，隔层妈","众人寻她千百度，蓦然回首，那人依旧对我不屑一顾","强者救赎自己，圣人普度他人","希望是美好的，也许是人间至善，而美好的事物永不消逝","其实光一直都在，我们只是需要一点时间来适应黑暗","既然已匆匆，不如早怀念","你可以打我，你可以骂我，但你千万不要说我没有努力过","天王盖地虎，宝塔镇河妖","有些事情你越想忘记，就会记得越牢","当有些事情你无法得到时，你惟一能做的，就是不要忘记","在最好的时间遇到你，是我的运气，可惜我没有时间了","都说人生无悔，那是赌气的话，如果真无悔，该有多无趣啊","世间所有的相遇，都是久别重逢","宁在一思进，莫在一思停","功夫，两个字，一横一竖，对的，站着，错的，倒下","练武之人，轻生死，重离别","念念不忘，必有回响，有一口气，点一盏灯，有灯就有人","过什么河脱什么鞋，有多大屁股穿多大裤衩","一念既出，万山无阻","做羹要讲究火候，火候不到，难以下咽，火候过了事情就焦","每个玩世不恭的人都会因为生活的洗礼而成长","世上本没有路，走的人多了，就更无路可走了","世界上最遥远的距离不是我在天涯你在海角，而是我在你身边你在玩手机","生命中充满了巧合，两条平行线也会有相交的一天","明天是另外的一天","有人就有恩怨，有恩怨就有江湖","往往都是事情改变人，人却改变不了事情","上帝会把我们身边最好的东西拿走，以提醒我们得到的太多","牵着你的手，就象左手牵右手没感觉，但砍下去也会疼","真相是一种美丽又可怕的东西，需要格外谨慎地对待","能力越大，责任越重","当我们没有得到正确答案时，那只是因为我们问错了问题","我猜着了开头，但我猜不中这结局","不是子弹，而是美女杀死了野兽","心里有就有，心里没有就没有","爱情这东西，时间很关键。认识得太早或太晚，都不行","麦兜他不是低能，他只是善良","其实，我是一个演员","生活就像一盒巧克力，你永远不知道你会得到什么","世界上总有一半人不理解另一半人的快乐","最了解你的人不是你的朋友，而是你的敌人","对于世界而言，你是一个人；但是对于某个人，你是他的整个世界","如果你不出去走走，你就会以为这就是世界","为了记住你的笑容，我拼命按下心中的快门","我们听过无数的道理，却仍旧过不好这一生","有时候，你想证明给一万个人看，到后来，你发现只得到了一个明白的人，那就够了","带不走的留不下，留不下的莫牵挂","当一艘船沉入海底，当一个人成了谜，你不知道，他们为何离去","当一辆车消失天际，当一个人成了谜，你不知道，他们为何离去","你不用对每个过客负责，也不用对每个路人说教","宁可自己去原谅别人，莫让别人来原谅你","愚痴的人，一直想要别人了解他。有智慧的人，却努力的了解自己","有些事情，现在不去做，以后很有可能永远也做不了","人生好似一个旅程，匆匆赶路的同时别忘了留一份心情欣赏沿途的风景","幸福有一千种，痛苦就会有一千种","志向不过是记忆的奴隶，生气勃勃地降生，但却很难成长","真正的才智是刚毅的志向","你不能左右天气，但你能转变你的心情","梦是一种欲望，想是一种行动","梦想是梦与想的结晶","心存希望，幸福就会降临你；心存梦想，机遇就会笼罩你","我们这个世界，从不会给一个伤心的落伍者颁发奖牌","骏马是跑出来的，强兵是打出来的","左右一个人成功的，不是能力，而是选择","人生最重要的一点是，永远不要迷失自己","一个人承受孤独的能力有多大，他的能力就有多大","对于强者，要关注他们的灵魂，对于弱者，他关注他们的生存","不要等待机会，而要创造机会","低头是一种能力，它不是自卑，也不是怯弱，它是清醒中的嬗变","没有一劳永逸的开始；也没有无法拯救的结束","不怕苦，吃苦三五年；怕吃苦，吃苦一辈子","古之立大事者，不惟有超世之材，亦必有坚忍不拨之志","千里之行，始于足下","发光并非太阳的专利，你也可以发光","我渐渐能意会到，深刻并不等于接近事实","死并非生的对立面，而作为生的一部分永存","不要同情自己，同情自己是卑劣懦夫干的勾当","曾经沧海难为水，除却巫山不是云","明月几时有，把酒问青天","恰同学少年，风华正茂","夜来风雨声，花落知多少","十年生死两茫茫","问君能有几多愁？恰似一江春水向东流","忽如一夜春风来，千树万树梨花开","行到水穷处，坐看云起时","海内存知己，天涯若比邻","枯藤老树昏鸦，小桥流水人家，古道西风瘦马","大漠孤烟直，长河落日圆","劝君更尽一杯酒，西出阳关无故人","会当凌绝顶，一览众山小","春蚕到死丝方尽，蜡炬成灰泪始干","黑发不知勤学早，白首方悔读书迟","冠盖满京华，斯人独憔悴","夕阳无限好，只是近黄昏","沾衣欲湿杏花雨，吹面不寒杨柳风","人面不知何处去，桃花依旧笑春风","东边日出西边雨，道是无晴却有晴","春花秋月何时了？往事知多少","古人学问无遗力，少壮工夫老始成","春风又绿江南岸，明月何时照我还","春色满园关不住，一枝红杏出墙来","独在异乡为异客，每逢佳节倍思亲","莫愁前路无知己，天下谁人不识君","沉舟侧畔千帆过，病树前头万木春","落红不是无情物，化作春泥更护花","谁言寸草心，报得三春晖","纸上得来终觉浅，绝知此事要躬行","红豆生南国，春来发几枝","问渠哪得清如许？为有源头活水来","孤帆远影碧空尽，唯见长江天际流","读书破万卷，下笔如有神","好雨知时节，当春乃发生","两情若是久长时，又岂在朝朝暮暮","欲把西湖比西子，淡妆浓抹总相宜","人间四月芳菲尽，山寺桃花始盛开","随风潜入夜，润物细无声","飞流直下三千尺，疑是银河落九天","身无彩凤双飞翼，心有灵犀一点通","月落乌啼霜满天，江枫渔火对愁眠","我欲乘风归去，又恐琼楼玉宇，高处不胜寒","小荷才露尖尖角，早有蜻蜓立上头","等闲识得东风面，万紫千红总是春","秦时明月汉时关，万里长征人未还","千古风流人物，一时多少雄豪","回首向来萧瑟处，归去，也无风雨也无晴","明月松间照，清泉石上流","千山鸟飞绝，万径人踪灭","读书不觉已春深，一寸光阴一寸金","春风得意马蹄疾，一日看尽长安花","白日依山尽，黄河入海流","三十功名尘与土，八千里路云和月","莫道不销魂，帘卷西风，人比黄花瘦","朝辞白帝彩云间，千里江陵一日还","碧玉妆成一树高，万条垂下绿丝绦","物是人非事事休，欲语泪先流","东风不与周郎便，铜雀春深锁二乔","两岸猿声啼不住，轻舟已过万重山","黄河远上白云间，一片孤城万仞山","姑苏城外寒山寺，夜半钟声到客船","横看成岭侧成峰，远近高低各不同","出师未捷身先死，长使英雄泪满襟","一骑红尘妃子笑，无人知是荔枝来","千里莺啼绿映红，水村山郭酒旗风","墙角数枝梅，凌寒独自开","举杯邀明月，对影成三人","仰天大笑出门去，我辈岂是蓬蒿人","昨夜星辰昨夜风，画楼西畔桂堂东","已是黄昏独自愁，更著风和雨","来如春梦不多时，去似朝云无觅处","闲云潭影日悠悠，物换星移几度秋","正是江南好风景，落花时节又逢君"],t=[],n=1,a=0,r=e.length;r>a;a++)for(var i=4,l=1;i>=l;l++){var s={};s.id=n,s.category=e[a],s.description=o[n-1],41>=n?s.create="1月18日":n>41&&82>=n?s.create="1月19日":n>82&&123>=n?s.create="1月20日":n>123&&164>=n&&(s.create="1月21日"),s.src="svg/iEmoji-"+e[a]+"-"+l+".svg",s.origin="http://hcy2367.github.io/iEmoji/images/iEmoji-"+e[a]+"-"+l+".png",n++,t.push(s)}if(arguments[0]&&arguments[1]){for(var c=arguments[0]||0,n=arguments[1]||10,d=t.length,u=[],g=0;d>g;g++)g>=c&&c+n>g&&u.push(t[g]);return JSON.stringify(u.reverse())}return JSON.stringify(t.reverse())}function loadEmoji(){function e(e,t){var n=generateData(e,t);n=JSON.parse(n),o(n)}function o(e){var o=Handlebars.compile(window.localStorage.getItem("emojiListTemp")),r=o(e);$("#loading_tip").remove(),$("#emoji_list").append($(r).html()),setTimeout(function(){n+=a,t.refresh()},0)}var t=new IScroll(".content",{scrollbars:!0,mouseWheel:!0,shrinkScrollbars:"scale",fadeScrollbars:!0}),n=20,a=20,r=JSON.parse(window.localStorage.getItem("emojis")).length,i='<li class="table-view-cell media" id="loading_tip"><img src="img/loading.gif"> 加载中...</span></li>',l='<li class="table-view-cell media" id="no_data_tip">没有更多数据</li>';t.on("scrollEnd",function(){{var o=this.y,t=this.maxScrollY,s=this.scrollerHeight;this.wrapperHeight,this.wrapperOffset}o===t&&(console.log(s),console.log(n,a),n>r?($("#no_data_tip").length||$("#emoji_list").append(l),console.log("no more data")):($("#emoji_list").append(i),setTimeout(function(){e(n,a)},1e3)))}),t.on("scrollCancel",function(){})}function toggleSearch(){var e=$("#emoji_search_zone"),o=$("#emoji_search_key"),t=$(".content");$(".header").on("click","#emoji_search_btn",function(n){n.preventDefault(),"none"===e.css("display")?(e.show().addClass("bar-header-secondary"),t.addClass("show-search"),o.addClass("active").focus()):(e.hide().removeClass("bar-header-secondary"),t.removeClass("show-search"),o.removeClass("active").blur())})}function searchHandler(e,o,t){var n=e.findByName(t),a=Handlebars.compile(o);$(".content .scroller").html(a(n))}function saveEmojiTrigger(e,o){e.on("click",function(){var e=o.attr("data-origin"),t=JSON.parse(window.localStorage.getItem("appRootDir")),n=t.nativeURL,a=(new Date).getTime()+".png";$(".bg-layer").show(),saveEmojiHandler(e,n+a)})}function saveEmojiHandler(e,o){var t=new FileTransfer,n=encodeURI(e);t.download(n,o,function(e){$(".bg-layer").hide(),navigator.notification.alert("表情已保存在："+o,null,"温馨提示","确定"),console.log("download complete: "+e.toURL()),console.log("download complete: "+e.fullPath)},function(e){$(".bg-layer").hide(),navigator.notification.alert("保存表情时出错，请重试",null,"温馨提示","确定"),console.log("download error source "+e.source),console.log("download error target "+e.target),console.log("download error code"+e.code),console.log("download error http_status"+e.http_status),console.log("download error exception"+e.exception),e.code===FileTransferError.FILE_NOT_FOUND_ERR&&console.log("download file not found"),e.code===FileTransferError.INVALID_URL_ERR&&console.log("download file invalid url"),e.code===FileTransferError.CONNECTION_ERR&&console.log("download file connection error")},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})}function downloadFile(e,o){var t=document.createElementNS("http://www.w3.org/1999/xhtml","a");t.href=o,t.download=e;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}function socialShare(e,o,t){var n={data:{content:{text:o,img:t}},topic:{dc:"default",name:"default",ni:1}};e.umshare(n)}function addLocation(){return event.preventDefault(),navigator.geolocation.getCurrentPosition(function(e){e.coords.latitude,e.coords.longitude;if($.getJSON("http://api.map.baidu.com/geocoder/v2/?ak=71709218d45a706b9c7e3abc2f037b23&callback=?&location="+e.coords.latitude+","+e.coords.longitude+"&output=json&pois=1",function(e){$(".current-location").text(e.result.addressComponent.province+"-"+e.result.addressComponent.city)}),"undefined"!=typeof e.address){var o=e.address.country,t=e.address.region,n=e.address.city;console.log("您位于"+o+t+"省"+n+"市")}},function(e){switch(e.code){case e.TIMEOUT:alert("连接超时，请重试");break;case e.PERMISSION_DENIED:alert("您拒绝了使用位置共享服务，查询已取消");break;case e.POSITION_UNAVAILABLE:alert("获取位置信息失败")}},{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4}),!1}function ajax(e,o){o=o||{};var t=new XMLHttpRequest,n=o.post||null,a=o.callback||null,r=o.timeout||null;t.onreadystatechange=function(){return 4==t.readyState?200!=t.status&&304!=t.status?void(a&&a(!1)):void(a&&a(t.responseText)):void 0},n?(t.open("POST",e,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded")):t.open("GET",e,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send(n),r&&setTimeout(function(){t.onreadystatechange=function(){},t.abort(),a&&a(!1)},r)}
var EmojiService=function(){this.initialize=function(){window.localStorage.setItem("emojis",generateData())},this.findById=function(e){for(var i=JSON.parse(window.localStorage.getItem("emojis")),t=null,n=i.length,o=0;n>o;o++)if(i[o].id===e){t=i[o];break}return t},this.findByName=function(e){var i=JSON.parse(window.localStorage.getItem("emojis")),t=i.filter(function(i){var t=i.category;return t.toLowerCase().indexOf(e.toLowerCase())>-1});return t},this.initialize()};
var HomeView=function(){this.initialize.apply(this,arguments)};HomeView.prototype={constructor:HomeView,initialize:function(t,e){this.template=t,this.tempData=e,Handlebars.registerPartial("emojiListTemp",window.localStorage.getItem("emojiListTemp")),this.render()},render:function(){var t=Handlebars.compile(this.template);$("body").html(t(this.tempData))}};
var EmojiView=function(){this.initialize.apply(this,arguments)};EmojiView.prototype={constructor:EmojiView,initialize:function(t,i){this.template=t,this.tempData=i,this.render()},render:function(){var t=Handlebars.compile(this.template);$("body").html(t(this.tempData))}};
var ShakeView=function(){this.initialize.apply(this,arguments)};ShakeView.prototype={constructor:ShakeView,initialize:function(i,e){this.template=i,this.tempData=e,this.render()},render:function(){var i=Handlebars.compile(this.template);$("body").html(i(this.tempData))},shake:function(){function i(i){var c=i.accelerationIncludingGravity,m=(new Date).getTime();if(m-l>100){var d=m-l;l=m,t=c.x,a=c.y,o=c.z;var g=Math.abs(t+a+o-n-s-r)/d*1e4;g>h&&($(".shake-go").hide(),$(".shake-tip").show(),navigator.notification.beep(1),navigator.notification.vibrate(1e3),setTimeout(function(){e.randomEmoji()},1e3)),n=t,s=a,r=o}}var e=this;window.DeviceMotionEvent?window.addEventListener("devicemotion",i,!1):navigator.notification.alert("本设备不支持devicemotion事件.",null,"提示","确定");var t,a,o,n,s,r,h=1e3,l=0},randomEmoji:function(){var i=[1,2,3,4],e=i[i.length-1],t=i[0],a=["blink","chill","chuckle","confused","cry","drooling","drowsy","embarrassed","flushed","grimace","grin","hellooo","hotkiss","hypnotized","inthedark","laugh","like","onfire","panic","pig","pleased","pucker","puke","scold","scowl","scream","sick","silence","skull","sleep","smile","smug","sneer","sniffle","sob","sobeye","strive","surprised","sweating","wink"],o=a[Math.floor(Math.random()*a.length)],n=Math.floor(Math.random()*(e-t+1))+t,s="http://hcy2367.github.io/iEmoji/svg/iEmoji-"+o+"-"+n+".svg",r="http://hcy2367.github.io/iEmoji/images/iEmoji-"+o+"-"+n+".png";$(".shake-tip").hide(),$(".save-emoji-btn").show(),$(".shake-emoji").show(),$(".shake-emoji").css("background-image","url("+s+")").attr("data-origin",r);var h="img/emoji/iEmoji-"+o+"-"+n+".png";socialShare($(".share-btn"),"表情宝",h)}};
var AboutView=function(){this.initialize.apply(this,arguments)};AboutView.prototype={constructor:AboutView,initialize:function(t,i){this.template=t,this.tempData=i,this.render()},render:function(){var t=Handlebars.compile(this.template);$("body").html(t(this.tempData))}};
!function(){function e(){navigator.splashscreen.hide(),StatusBar.overlaysWebView(!1),StatusBar.backgroundColorByHexString("#ffffff"),StatusBar.styleDefault(),FastClick.attach(document.body),navigator.notification,t(),o()}function t(){function e(e){var i=e.root;i.getDirectory("iEmoji",{create:!0,exclusive:!1},t,o)}function t(e){window.localStorage.setItem("appRootDir",JSON.stringify(e))}function o(e){navigator.notification.alert("unable to create new directory: "+e.code,null,"tip","确定")}function i(e){navigator.notification.alert("FileSystem error:"+e.target.error.code,null,"tip","确定")}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e,i)}function o(){window.localStorage.setItem("homeTemp",$("#home-tpl").html()),window.localStorage.setItem("emojiListTemp",$("#emoji-list-tpl").html()),window.localStorage.setItem("emojiTemp",$("#emoji-tpl").html()),window.localStorage.setItem("aboutTemp",$("#about-tpl").html()),window.localStorage.setItem("shakeTemp",$("#shake-tpl").html()),router.addRoute("/index",function(){for(var e=JSON.parse(window.localStorage.getItem("emojis")),t=[],o=0,a=e.length;a>o;o++)20>o&&t.push(e[o]);new HomeView(window.localStorage.getItem("homeTemp"),t),toggleSearch(),$("#emoji_search_zone").on("keyup","#emoji_search_key",function(){searchHandler(i,window.localStorage.getItem("emojiListTemp"),$.trim($(this).val()))}),loadEmoji(),document.addEventListener("touchmove",function(e){e.preventDefault()},!1)}),router.addRoute("/shake",function(){var e=new ShakeView(window.localStorage.getItem("shakeTemp"),{hand:"hand.png",loading:"loading.gif"});e.shake(),saveEmojiTrigger($(".save-emoji-btn"),$(".shake-emoji"))}),router.addRoute("/about",function(){new AboutView(window.localStorage.getItem("aboutTemp"),{name:"chmyun",avatar:"default-avatar.png",signature:"少年不知愁滋味",iWeiXin:"icon-weixin.png",weixin:"hcy_good_noy",iWeiBo:"icon-weibo.png",weibo:"chmyun",iQQ:"icon-qq.png",qq:"729555742"});$("#about");addLocation()}),router.addRoute("/emoji/:id",function(e){var t=i.findById(parseInt(e));new EmojiView(window.localStorage.getItem("emojiTemp"),t),saveEmojiTrigger($("#emoji_detail .save-btn"),$("#emoji_detail .media-object"));var o="表情："+$("#emoji_detail .category strong").text()+"\n"+$("#emoji_detail .desc strong").text(),a=$("#emoji_detail .media-object").attr("src");a="img/emoji/"+a.split("svg/")[1].split(".")[0]+".png",socialShare($(".share-btn"),o,a)}),router.start()}window.umappkey="54c0948bfd98c5550500010f";var i=new EmojiService;document.addEventListener("deviceready",e,!1),$(function(){})}();